<div class="container">
    <form [formGroup]="orderForm">
      <div class="card">
        <div class="card-header">Edit Order</div>
        <div class="card-body">
          <div class="form-group row">
            <div class="col-lg-3 col-md-3">
              <label class="required">Site</label>
              <ng-select [items]="siteOptions" placeholder="Type and search site" bindLabel="branch_name" bindValue="branch_name"
                formControlName="site">
              </ng-select>
            </div>
  
            <div class="col-lg-3 col-md-3">
              <label class="required">Order type</label>
              <select class="form-control" formControlName="order_type" (change)="generateOrderNumber()">
                <option value="">Please select order type</option>
                <option value="Job order">Job order</option>
                <option value="Purchase order">Purchase order</option>
              </select>
            </div>

            <div class="col-lg-2 col-md-2">
              <label class="required">Order no</label>
              <input disabled type="text" formControlName="order_number" class="form-control" placeholder="Please enter order no">
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="required">Order date</label>
              <div class="input-group datepicker-input">
                <input
                  class="form-control"
                  placeholder="dd-mm-yyyy"
                  name="dp2"
                  formControlName="order_date"
                  ngbDatepicker
                  #d2="ngbDatepicker" 
                />
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary calendar" (click)="d2.toggle()" type="button">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
  
   
            <div class="col-lg-2 col-md-2">
              <label>Delivery date</label>
              <div class="input-group datepicker-input">
                <input
                  class="form-control"
                  placeholder="dd-mm-yyyy"
                  name="dp1"
                  formControlName="delivery_date"
                  ngbDatepicker
                  #d1="ngbDatepicker" 
                />
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary calendar" (click)="d1.toggle()" type="button">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group row">

  
            <div class="col-lg-3 col-md-3">
              <label class="required">Vendor</label>
              <ng-select [items]="vendor_option" placeholder="Type and search vendor" bindLabel="name" bindValue="name"
                formControlName="vendor">
              </ng-select>
            </div>
              <div class="col-lg-2 col-md-2">
              <label class="required">Job type</label>
              <select class="form-control" formControlName="job_type">
                <option value="">Please select job type</option>
                <option value="Direct">Direct</option>
                <option value="Job order">Job order</option>
                <option value="Estimate">Estimate</option>
              </select>
            </div>
            <div class="col-lg-3 col-md-3">
              <label class="required">Department</label>
              <ng-select [items]="dept_option" placeholder="Type and search Department" bindLabel="deptname" bindValue="deptname"
                formControlName="department">
              </ng-select>
            </div>
              </div>
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  Order line items
                  <button class="btn btn-primary float-right" (click)="addOrderItems()" [disabled]="!orderForm.valid"
                    type="button">
                    Add Item
                  </button>
                </div>
                <!-- /.box-header -->
                <div class="card-body" *ngIf="orderForm.controls.order_items.controls.length > 0">
                  <table class="table table-bordered" formArrayName="order_items">
                    <tr>
                      <th>Item</th>
                      <th>Unit</th>
                      <th>Qty</th>
                      <th>Price(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                      <th>Dis(%)</th>
                      <th>CGST(%)</th>
                      <th>SGST(%)</th>
                      <th>IGST(%)</th>
                      <th>Amount(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                      <th>Action</th>
                    </tr>
                    <tr *ngFor="let school of orderForm.controls.order_items.controls; let i=index" formGroupName="{{i}}">
                      <td>
                        <div class="input-group ngs">
                          <div class="col-md-12">
                            <ng-select [items]="order_items" appendTo=".card-body" class="form-control" style="width:250px !important;" placeholder="Type and search items" bindLabel="name" bindValue="_id"
                            formControlName="item_id">
                          </ng-select>
                          </div>
                        </div>
                      </td>
                        <td>
                        <div class="input-group">
                          <select class="form-control" formControlName="unit">
                            <option value="">Please select units</option>
                            <option *ngFor="let option of unit_option" [value]="option"> {{option}}</option>
                          </select>
                        </div>
                      </td>
                      <td>
                        <input type="number" min="0"  formControlName="qty"
                          class="form-control qty">
                      </td>
                      <td>
                        <input type="number" min="0" formControlName="price" class="form-control price">
  
                      </td>
                      <td>
                        <input type="number" min="0" formControlName="discount"  class="form-control discount">
                      </td>
                      <td>
                        <input type="number" min="0"  formControlName="cgst" class="form-control discount">
                      </td>
                      <td>
                        <input type="number" min="0" formControlName="sgst"  class="form-control discount">
                      </td>
                      <td>
                        <input type="number" min="0"  formControlName="igst" class="form-control discount">
                      </td>
                      <td>
                        <input type="number" min="0" formControlName="total" class="form-control total">
  
                      </td>
                      <td>
                        <button class="btn btn-danger float-right" [disabled]="orderForm.controls?.order_items.controls.length == 1" (click)="removeItems(i)" type="button">
                          <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                      </td>
                    </tr>
                  </table>
                </div>
                <div class="card-body" *ngIf="orderForm.controls?.order_items.controls.length == 0">
                  <p>Please select vendor</p>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-3">
            <div class="form-group row">
              <div class="col-lg-6 col-md-6">
                <label class="">Narration</label>
                <input type="text" formControlName="narration" class="form-control" placeholder="Please enter narration">
              </div>
              <div class="col-lg-6 col-md-6">
                <label class="">Terms And Conditions</label>
                <input type="text" formControlName="terms_and_conditions" class="form-control"
                  placeholder="Please enter terms and conditions">
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-3 col-md-3">
                <label class="">Net Amt</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                  </div>
                  <input type="number" min="0" formControlName="net_amount" class="form-control">
                </div>
              </div>
              <div class="col-lg-3 col-md-3">
                <label class="">Rounded off</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                  </div>
                  <input type="number" min="0" formControlName="rounded_off" class="form-control">
                </div>
              </div>
              <div class="col-lg-3 col-md-3">
                <label class="required">Round of Type</label>
                <select class="form-control" formControlName="round_off_type">
                  <option>Please select site</option>
                  <option value="plus">Plus</option>
                  <option value="minus">Minus</option>
                </select>
              </div>
              <div class="col-lg-3 col-md-3">
                <label class="">Total</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                  </div>
                  <input type="number" min="0" formControlName="total_amount" class="form-control">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <button class="btn btn-success float-right" (click)="saveOrders()" [disabled]="!orderForm.valid || process == 'saving'" type="button">
            Save <i *ngIf="process == 'saving'" class="fa fa-spinner fa-spin"></i>
          </button>
        </div>
      </div>
    </form>
  </div>