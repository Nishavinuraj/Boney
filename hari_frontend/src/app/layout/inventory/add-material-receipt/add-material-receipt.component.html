<div class="container">
  <form [formGroup]="mrForm">
    <div class="card">
      <div class="card-header">Add Material Receipt</div>
      <div class="card-body">
        <div class="form-group row">
          <div class="col-md-3">
            <label class="required">Site</label>
            <ng-select [items]="siteOptions" placeholder="Type and search site" bindLabel="branch_name" bindValue="branch_name"
              formControlName="site">
            </ng-select>
          </div>
          <div class="col-md-3">
            <label class="required">MR type</label>
            <select class="form-control" formControlName="mr_type" (change)="generateMrNumber()">
              <option value="">Select MR type</option>
              <option value="Material Receipt">Material Receipt</option>
              <option value="Material Return">Material Return</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="required">MR no</label>
            <input disabled type="text" formControlName="mr_number" class="form-control" placeholder="">
          </div>

          <div class="col-md-3">
            <label class="required">MR date</label>
            <div class="input-group datepicker-input">
              <input
                class="form-control"
                placeholder="dd-mm-yyyy"
                name="dp2"
                formControlName="mr_date"
                ngbDatepicker
                #d2="ngbDatepicker" 
              />
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="d2.toggle()" type="button">
                  <i class="fa fa-calendar" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <label class="required">Receipt type</label>
            <select class="form-control" formControlName="rec_type">
              <option value="">Select Receipt type</option>
              <option value="Direct">Direct</option>
              <option value="Job Order">Job Order</option>
              <option value="Purchase Order">Purchase Order</option>
              <option value="Scrap">Scrap</option>
              <option value="Stock Transfer">Stock Transfer</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="required">Godown</label>
            <select class="form-control" formControlName="godown">
              <option value="">Select Godown</option>
              <option *ngFor="let g of godowns" value="{{ g.godown }}">
                {{ g.godown }}
            </select>
          </div>
          <div class="col-md-3">
            <label class="required">Vendor</label>
            <ng-select [items]="vendor_option" placeholder="Type and search vendor" bindLabel="name" bindValue="name"
              formControlName="vendor">
            </ng-select>
          </div>

          <div class="col-md-3">
            <label class="required">Department</label>
            <ng-select [items]="dept_option" placeholder="Type and search Department" bindLabel="deptname" bindValue="deptname"
              formControlName="department">
            </ng-select>
          </div>

          <div class="col-md-3">
            <label class="">Invoice No</label>
            <input type="text" formControlName="invno" class="form-control" placeholder="Invoice No">
          </div>

          <div class="col-md-3">
            <label>Invoice date</label>
            <div class="input-group datepicker-input">
              <input
                class="form-control"
                placeholder="dd-mm-yyyy"
                name="dp3"
                formControlName="invdate"
                ngbDatepicker
                #d3="ngbDatepicker" 
              />
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="d3.toggle()" type="button">
                  <i class="fa fa-calendar" aria-hidden="true"></i>
                </button>
              </div>
          </div>
        </div>

          <div class="col-md-3">
            <label class="">Po No. / Job No.</label>
            <input type="text" formControlName="pjno" class="form-control" placeholder="Po.No / Job No.">
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                Material Receipts items
                <button class="btn btn-primary float-right" (click)="addMrItems()" [disabled]="!mrForm.valid"
                  type="button">
                  Add Item
                </button>
              </div>
              <!-- /.box-header -->
              <div class="card-body" *ngIf="mrForm.controls.materialr_items.controls.length > 0">
                <table class="table table-bordered" formArrayName="materialr_items">
                  <tr>
                    <th>Item</th>
                    <th>Unit</th>
                    <th>Qty</th>
                    <th>Price(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                    <th>Dis(%)</th>
                    <th>CGST(%)</th>
                    <th>SGST(%)</th>
                    <th>IGST(%)</th>
                    <th>Amount(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                    <th>Action</th>
                  </tr>
                  
                  
                  <tr *ngFor="let school of mrForm.controls.materialr_items.controls; let i=index" formGroupName="{{i}}">
                    <!-- <td>
                      <div class="input-group ngs">
                        <div class="col-md-12">
                          <ng-select [items]="materialr_items" appendTo=".card-body" class="form-control" style="width:250px !important;" placeholder="Type and search items" bindLabel="name" bindValue="_id"
                          formControlName="item_id">
                        </ng-select>
                        </div>
                      </div>
                    </td> -->
                    <td>
                      <div class="input-group ngs">
                        <div class="col-md-12">
                          <ng-select [items]="materialr_items" appendTo=".card-body" class="form-control" style="width:250px !important;" placeholder="Type and search items" bindLabel="name" bindValue="_id"
                          formControlName="item_id">
                        </ng-select>
                        </div>
                      </div>
                    </td>

                    <td>
                      <div class="input-group">
                        <select class="form-control" formControlName="unit">
                          <option value="">Please select units</option>
                          <option *ngFor="let option of unit_option" [value]="option"> {{option}}</option>
                        </select>
                      </div>
                    </td>
                    <td>
                      <input type="number" min="0"  formControlName="qty"
                        class="form-control qty">
                    </td>
                    <td>
                      <input type="number" min="0" formControlName="price" class="form-control price">

                    </td>
                    <td>
                      <input type="number" min="0" formControlName="discount"  class="form-control discount">
                    </td>
                    <td>
                      <input type="number" min="0"  formControlName="cgst" class="form-control discount">
                    </td>
                    <td>
                      <input type="number" min="0" formControlName="sgst"  class="form-control discount">
                    </td>
                    <td>
                      <input type="number" min="0"  formControlName="igst" class="form-control discount">
                    </td>
                    <td>
                      <input type="number" min="0" formControlName="total" class="form-control total">

                    </td>
                    <td>
                      <button class="btn btn-danger float-right" [disabled]="mrForm.controls?.materialr_items.controls.length == 1" (click)="removeItems(i)" type="button">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                      </button>
                    </td>
                  </tr>
                </table>
              </div>
              <div class="card-body" *ngIf="mrForm.controls?.materialr_items.controls.length == 0">
                <p>Please select vendor</p>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <div class="form-group row">
            <div class="col-lg-6 col-md-6">
              <label class="">Narration</label>
              <input type="text" formControlName="narration" class="form-control" placeholder="Please enter narration">
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="">Gross Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="gross_amount" class="form-control">
              </div>
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="">CGST Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="cgst_amount" class="form-control">
              </div>
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="">SGST Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="sgst_amount" class="form-control">
              </div>
            </div>

          </div>
          <div class="form-group row">
            <div class="col-lg-2 col-md-2">
              <label class="">IGST Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="igst_amount" class="form-control">
              </div>
            </div>



            <div class="col-lg-2 col-md-2">
              <label class="">Net Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="net_amount" class="form-control">
              </div>
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="">Rounded off</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="rounded_off" class="form-control">
              </div>
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="required">Round of Type</label>
              <select class="form-control" formControlName="round_off_type">
                <option>Please select site</option>
                <option value="plus">Plus</option>
                <option value="minus">Minus</option>
              </select>
            </div>
            <div class="col-lg-2 col-md-2">
              <label class="">Total</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="total_amount" class="form-control">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <button class="btn btn-success float-right" (click)="save()" [disabled]="!mrForm.valid || process == 'saving'" type="button">
          Save <i *ngIf="process == 'saving'" class="fa fa-spinner fa-spin"></i>
        </button>
      </div>
    </div>
  </form>
</div>