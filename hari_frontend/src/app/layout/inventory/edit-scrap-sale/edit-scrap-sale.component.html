<div class="container">
  <form [formGroup]="ssForm">
    <div class="card">
      <div class="card-header">Edit Scrap Sale</div>
      <div class="card-body">

        <div class="form-group row">
          <div class="col-md-3">
            <label class="required">Site</label>
            <ng-select [items]="siteOptions" placeholder="Type and search site" bindLabel="branch_name" bindValue="branch_name"
              formControlName="site">
            </ng-select>
          </div>
          <div class="col-md-3">
            <label class="required">Sale type</label>
            <select class="form-control" formControlName="ss_type" (change)="generateSsNumber()">
              <option value="">Select Sale type</option>
              <option value="Scrap Sale">Scrap Sale</option>
              <option value="Truck Issue">Truck Issue</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="required">Scrap Sale no</label>
            <input disabled type="text" formControlName="ss_number" class="form-control">
          </div>

          <div class="col-md-3">
            <label class="required">Scrap Sale date</label>
            <div class="input-group datepicker-input">
              <input
                class="form-control"
                placeholder="dd-mm-yyyy"
                name="dp2"
                formControlName="ss_date"
                ngbDatepicker
                #d2="ngbDatepicker" 
              />
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="d2.toggle()" type="button">
                  <i class="fa fa-calendar" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>
  
          <div class="col-md-3">
            <label class="required">Issued By</label>
            <select class="form-control" formControlName="issuedby">
              <option value="">Select Issued By</option>
              <option *ngFor="let i of issuedby_option" [value]="i.issuedby"> {{i.issuedby}}</option>
            </select>
          </div>

          <div class="col-md-3">
            <label class="required">Department</label>
            <ng-select [items]="dept_option" placeholder="Type and search Department" bindLabel="deptname" bindValue="deptname"
              formControlName="department">
            </ng-select>
          </div>
          <div class="col-md-6">
            <label class="required">Vendor</label>
            <ng-select [items]="vendor_option" placeholder="Type and search vendor" bindLabel="name" bindValue="name"
              formControlName="vendor">
            </ng-select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                Material Issue items
                <button class="btn btn-primary float-right" (click)="addSsItems()" [disabled]="!ssForm.valid"
                  type="button">
                  Add Item
                </button>
              </div>
              <!-- /.box-header -->
              <div class="card-body" *ngIf="ssForm.controls.scraps_items.controls.length > 0">
                <table class="table table-bordered" formArrayName="scraps_items">
                  <tr>
                    <th>Item</th>
                    <th>Unit</th>
                    <th>Qty</th>
                    <th>Price(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                    <th>Godown</th>
                    <th>Amount(<i class="fa fa-inr" aria-hidden="true"></i>)</th>
                    <th>Action</th>
                  </tr>
                  <tr *ngFor="let school of ssForm.controls.scraps_items.controls; let i=index" formGroupName="{{i}}">
                    <td>
                      <div class="input-group ngs">
                        <div class="col-md-12">
                          <ng-select [items]="scraps_items" appendTo=".card-body" class="form-control" style="width:250px !important;" placeholder="Type and search items" bindLabel="name" bindValue="_id"
                          formControlName="item_id">
                        </ng-select>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="input-group">
                        <select class="form-control" formControlName="unit">
                          <option value="">Select units</option>
                          <option *ngFor="let option of unit_option" [value]="option"> {{option}}</option>
                        </select>
                      </div>
                    </td>
                    <td>
                      <input type="number" min="0"  formControlName="qty"
                        class="form-control qty">
                    </td>

                    <td>
                      <input type="number" min="0" formControlName="price" class="form-control price">
                    </td>

                    <td>
                      <div class="input-group">
                        <select class="form-control" formControlName="godown">
                          <option value="">Select godown</option>
                          <option *ngFor="let g of scraps_godowns" [value]="g.godown"> {{g.godown}}</option>
                        </select>
                      </div>
                    </td>
                    <td>
                      <input type="number" min="0" formControlName="total" class="form-control total">
                    </td>
                    <td>
                      <button class="btn btn-danger float-right" [disabled]="ssForm.controls?.scraps_items.controls.length == 1" (click)="removeItems(i)" type="button">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                      </button>
                    </td>
                  </tr>
                </table>
              </div>
              <div class="card-body" *ngIf="ssForm.controls?.scraps_items.controls.length == 0">
                <p>Please select vendor</p>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <div class="form-group row">
            <div class="col-lg-6 col-md-6">
              <label class="">Narration</label>
              <input type="text" formControlName="narration" class="form-control" placeholder="Please enter narration">
            </div>
          </div>
          <div class="form-group row">
            <div class="col-lg-3 col-md-3">
              <label class="">Net Amt</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="net_amount" class="form-control">
              </div>
            </div>
            <div class="col-lg-3 col-md-3">
              <label class="">Rounded off</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="rounded_off" class="form-control">
              </div>
            </div>
            <div class="col-lg-3 col-md-3">
              <label class="required">Round of Type</label>
              <select class="form-control" formControlName="round_off_type">
                <option>Please select site</option>
                <option value="plus">Plus</option>
                <option value="minus">Minus</option>
              </select>
            </div>
            <div class="col-lg-3 col-md-3">
              <label class="">Total</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fa fa-inr" aria-hidden="true"></i></span>
                </div>
                <input type="number" min="0" formControlName="total_amount" class="form-control">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <button class="btn btn-success float-right" (click)="saveSs()" [disabled]="!ssForm.valid || process == 'saving'" type="button">
          Save <i *ngIf="process == 'saving'" class="fa fa-spinner fa-spin"></i>
        </button>
      </div>
    </div>
  
  </form>
</div>